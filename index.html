<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Infinity Bank | Inflation Sim</title>
    <style>
        :root { --bg: #0a0a0c; --gold: #ffd700; --red: #ff4d4d; --green: #00ff88; }
        body { background: var(--bg); color: white; font-family: 'Orbitron', sans-serif; margin: 0; display: flex; justify-content: center; }
        .app { width: 100%; max-width: 450px; padding: 20px; }

        /* –¢–∞–±–ª–æ –∏–Ω—Ñ–ª—è—Ü–∏–∏ */
        .market-header { 
            background: #16161a; padding: 20px; border-radius: 20px; 
            border-bottom: 3px solid var(--red); margin-bottom: 20px; text-align: center;
        }
        .inflation-rate { font-size: 24px; color: var(--red); font-weight: bold; }

        /* –ö–∞—Ä—Ç–∞ —Å—á–µ—Ç–∞ */
        .card { 
            background: linear-gradient(135deg, #1a1c22 0%, #000 100%);
            padding: 30px; border-radius: 25px; border: 1px solid #333;
            box-shadow: 0 15px 35px rgba(0,0,0,0.5); margin-bottom: 20px;
        }
        .money-val { font-size: 48px; color: var(--green); text-shadow: 0 0 15px rgba(0,255,136,0.3); }

        /* –ì–ª–æ–±–∞–ª—å–Ω—ã–π –ø—É–ª –¥–µ–Ω–µ–≥ */
        .pool-info { font-size: 14px; color: #888; margin-bottom: 10px; }
        .pool-val { color: var(--gold); font-weight: bold; }

        /* –ö–Ω–æ–ø–∫–∏ */
        .btn-loot { 
            width: 100%; padding: 20px; border-radius: 15px; border: none;
            background: var(--green); color: black; font-size: 18px; font-weight: 900;
            cursor: pointer; transform: scale(1); transition: 0.1s;
        }
        .btn-loot:active { transform: scale(0.95); }
        
        .transfer-box { 
            background: #16161a; padding: 15px; border-radius: 15px; margin-top: 20px;
        }
        input { width: 100%; background: #000; border: 1px solid #333; color: white; padding: 10px; border-radius: 8px; margin: 5px 0; }
    </style>
</head>
<body>

<div class="app">
    <div class="market-header">
        <div style="font-size: 12px; opacity: 0.6;">–£–†–û–í–ï–ù–¨ –ò–ù–§–õ–Ø–¶–ò–ò</div>
        <div class="inflation-rate" id="inflation-pct">0.00%</div>
        <div style="font-size: 10px; color: #555;">(–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –æ–±—â–µ–π –º–∞—Å—Å—ã –¥–µ–Ω–µ–≥ –≤ —Å–∏—Å—Ç–µ–º–µ)</div>
    </div>

    <div class="card">
        <div class="pool-info">–í —Å–∏—Å—Ç–µ–º–µ –Ω–∞–ø–µ—á–∞—Ç–∞–Ω–æ: <span class="pool-val" id="global-pool">0.00</span> $</div>
        <div style="font-size: 12px; color: #888;">–í–∞—à –±–∞–ª–∞–Ω—Å:</div>
        <div class="money-val" id="user-balance">0.00</div>
    </div>

    <button class="btn-loot" onclick="lootMoney()">–õ–£–¢–ê–¢–¨ –í–´–ü–õ–ê–¢–£ üí∏</button>

    <div class="transfer-box">
        <div style="font-size: 12px; margin-bottom: 10px;">–ü–ï–†–ï–í–û–î –î–†–£–ì–£</div>
        <input type="text" id="target-id" placeholder="UID –ø–æ–ª—É—á–∞—Ç–µ–ª—è">
        <input type="number" id="amount" placeholder="–°—É–º–º–∞">
        <button onclick="sendMoney()" style="width:100%; background:#3b82f6; color:white; border:none; padding:10px; border-radius:8px; margin-top:5px;">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, set, onValue, runTransaction, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–≤–æ–π —Å—Ç–∞—Ä—ã–π –∫–æ–Ω—Ñ–∏–≥ –æ—Ç –∑–∞–º–µ—Ç–æ–∫
    const firebaseConfig = {
        apiKey: "AIzaSyDOmPzdDi6n6vICcDMoAytqVQ9nr9ZLERQ",
        authDomain: "notes-f9e8b.firebaseapp.com",
        databaseURL: "https://notes-f9e8b-default-rtdb.firebaseio.com",
        projectId: "notes-f9e8b"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // –í —É—á–µ–±–Ω—ã—Ö —Ü–µ–ª—è—Ö –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º ID —Å–µ—Å—Å–∏–∏ (–∏–º–∏—Ç–∞—Ü–∏—è —é–∑–µ—Ä–∞ –±–µ–∑ –ª–æ–≥–∏–Ω–∞ –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏)
    const myUid = localStorage.getItem('eco_uid') || 'u' + Math.floor(Math.random()*10000);
    localStorage.setItem('eco_uid', myUid);
    alert("–¢–≤–æ–π ID –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–µ–Ω–µ–≥: " + myUid);

    // 1. –°–ò–°–¢–ï–ú–ê –ü–ï–ß–ê–¢–ò –î–ï–ù–ï–ì (—Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —É "–ú–∞—Å—Ç–µ—Ä–∞", –Ω–æ –º—ã —Å–¥–µ–ª–∞–µ–º –æ–±—â—É—é)
    // –ö–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π –ø—É–ª
    setInterval(() => {
        runTransaction(ref(db, 'eco_sim/global_pool'), (current) => (current || 0) + 1.50);
    }, 1000);

    // 2. –ú–û–ù–ò–¢–û–†–ò–ù–ì –≠–ö–û–ù–û–ú–ò–ö–ò
    onValue(ref(db, 'eco_sim'), (snap) => {
        const data = snap.val() || {};
        const pool = data.global_pool || 0;
        const totalInHands = data.total_money_in_circulation || 1;

        document.getElementById('global-pool').innerText = pool.toFixed(2);
        
        // –†–∞—Å—á–µ—Ç –∏–Ω—Ñ–ª—è—Ü–∏–∏ (–ø—Ä–∏–º–µ—Ä: —á–µ–º –±–æ–ª—å—à–µ –¥–µ–Ω–µ–≥ —É –ª—é–¥–µ–π –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø—É–ª–∞, —Ç–µ–º –≤—ã—à–µ –∏–Ω—Ñ–ª—è—Ü–∏—è)
        const inflation = (totalInHands / 1000) * 100;
        document.getElementById('inflation-pct').innerText = inflation.toFixed(2) + '%';
    });

    // 3. –¢–í–û–ô –ë–ê–õ–ê–ù–°
    onValue(ref(db, `eco_sim/users/${myUid}/balance`), (snap) => {
        document.getElementById('user-balance').innerText = (snap.val() || 0).toFixed(2);
    });

    // 4. –õ–£–¢–ò–ù–ì (–ó–∞–±—Ä–∞—Ç—å –¥–µ–Ω—å–≥–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã)
    window.lootMoney = () => {
        const amountToLoot = 5.00; // –°–∫–æ–ª—å–∫–æ —é–∑–µ—Ä —Ö–æ—á–µ—Ç –∑–∞–±—Ä–∞—Ç—å –∑–∞ —Ä–∞–∑

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –¥–µ–Ω—å–≥–∏ –≤ –ø—É–ª–µ
        runTransaction(ref(db, 'eco_sim/global_pool'), (pool) => {
            if (pool >= amountToLoot) {
                // –ï—Å–ª–∏ –≤ –ø—É–ª–µ –µ—Å—Ç—å –¥–µ–Ω—å–≥–∏, –Ω–∞—á–∏—Å–ª—è–µ–º —é–∑–µ—Ä—É
                runTransaction(ref(db, `eco_sim/users/${myUid}/balance`), (bal) => (bal || 0) + amountToLoot);
                // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –æ–±—â—É—é –º–∞—Å—Å—É –¥–µ–Ω–µ–≥ (–¥–ª—è –∏–Ω—Ñ–ª—è—Ü–∏–∏)
                runTransaction(ref(db, 'eco_sim/total_money_in_circulation'), (total) => (total || 0) + amountToLoot);
                return pool - amountToLoot;
            }
            return; // –ï—Å–ª–∏ –ø—É–ª –ø—É—Å—Ç, –Ω–∏—á–µ–≥–æ –Ω–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç
        });
    };

    // 5. –ü–ï–†–ï–í–û–î
    window.sendMoney = async () => {
        const target = document.getElementById('target-id').value;
        const amount = parseFloat(document.getElementById('amount').value);
        if(!target || amount <= 0) return;

        const myBalRef = ref(db, `eco_sim/users/${myUid}/balance`);
        const res = await runTransaction(myBalRef, (cur) => {
            if (cur >= amount) return cur - amount;
            return;
        });

        if(res.committed) {
            runTransaction(ref(db, `eco_sim/users/${target}/balance`), (cur) => (cur || 0) + amount);
            alert("–ü–µ—Ä–µ–≤–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω!");
        } else {
            alert("–ú–∞–ª–æ –±–∞–±–æ–∫!");
        }
    };
</script>
</body>
</html>
